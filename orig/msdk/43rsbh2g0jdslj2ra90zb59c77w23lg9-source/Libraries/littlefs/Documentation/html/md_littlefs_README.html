<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>MAX3267X LittleFS demo: littlefs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MAX3267X LittleFS demo
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_littlefs_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">littlefs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A little fail-safe filesystem designed for microcontrollers.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;   | | |     .---._____</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  .-----.   |          |</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;--|o    |---| littlefs |</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;--|     |---|          |</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &#39;-----&#39;   &#39;----------&#39;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   | | |</div></div><!-- fragment --><p><b>Power-loss resilience</b> - littlefs is designed to handle random power failures. All file operations have strong copy-on-write guarantees and if power is lost the filesystem will fall back to the last known good state.</p>
<p><b>Dynamic wear leveling</b> - littlefs is designed with flash in mind, and provides wear leveling over dynamic blocks. Additionally, littlefs can detect bad blocks and work around them.</p>
<p><b>Bounded RAM/ROM</b> - littlefs is designed to work with a small amount of memory. RAM usage is strictly bounded, which means RAM consumption does not change as the filesystem grows. The filesystem contains no unbounded recursion and dynamic memory is limited to configurable buffers that can be provided statically.</p>
<h2>Example</h2>
<p>Here's a simple example that updates a file named <code>boot_count</code> every time main runs. The program can be interrupted at any time without losing track of how many times it has been booted and without corrupting the filesystem:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;#include &quot;lfs.h&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;// variables used by the filesystem</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;lfs_t lfs;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;lfs_file_t file;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;// configuration of the filesystem is provided by this struct</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;const struct lfs_config cfg = {</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    // block device operations</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    .read  = user_provided_block_device_read,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    .prog  = user_provided_block_device_prog,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    .erase = user_provided_block_device_erase,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    .sync  = user_provided_block_device_sync,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    // block device configuration</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    .read_size = 16,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    .prog_size = 16,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    .block_size = 4096,</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    .block_count = 128,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    .cache_size = 16,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    .lookahead_size = 16,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    .block_cycles = 500,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;};</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;// entry point</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;int main(void) {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    // mount the filesystem</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    int err = lfs_mount(&amp;lfs, &amp;cfg);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    // reformat if we can&#39;t mount the filesystem</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    // this should only happen on the first boot</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    if (err) {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        lfs_format(&amp;lfs, &amp;cfg);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        lfs_mount(&amp;lfs, &amp;cfg);</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    // read current count</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    uint32_t boot_count = 0;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    lfs_file_open(&amp;lfs, &amp;file, &quot;boot_count&quot;, LFS_O_RDWR | LFS_O_CREAT);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    lfs_file_read(&amp;lfs, &amp;file, &amp;boot_count, sizeof(boot_count));</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    // update boot count</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    boot_count += 1;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    lfs_file_rewind(&amp;lfs, &amp;file);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    lfs_file_write(&amp;lfs, &amp;file, &amp;boot_count, sizeof(boot_count));</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    // remember the storage is not updated until the file is closed successfully</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    lfs_file_close(&amp;lfs, &amp;file);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    // release any resources we were using</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    lfs_unmount(&amp;lfs);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    // print the boot count</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    printf(&quot;boot_count: %d\n&quot;, boot_count);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div></div><!-- fragment --><h2>Usage</h2>
<p>Detailed documentation (or at least as much detail as is currently available) can be found in the comments in <a href="lfs.h">lfs.h</a>.</p>
<p>littlefs takes in a configuration structure that defines how the filesystem operates. The configuration struct provides the filesystem with the block device operations and dimensions, tweakable parameters that tradeoff memory usage for performance, and optional static buffers if the user wants to avoid dynamic memory.</p>
<p>The state of the littlefs is stored in the <code>lfs_t</code> type which is left up to the user to allocate, allowing multiple filesystems to be in use simultaneously. With the <code>lfs_t</code> and configuration struct, a user can format a block device or mount the filesystem.</p>
<p>Once mounted, the littlefs provides a full set of POSIX-like file and directory functions, with the deviation that the allocation of filesystem structures must be provided by the user.</p>
<p>All POSIX operations, such as remove and rename, are atomic, even in event of power-loss. Additionally, file updates are not actually committed to the filesystem until sync or close is called on the file.</p>
<h2>Other notes</h2>
<p>Littlefs is written in C, and specifically should compile with any compiler that conforms to the <code>C99</code> standard.</p>
<p>All littlefs calls have the potential to return a negative error code. The errors can be either one of those found in the <code>enum lfs_error</code> in <a href="lfs.h">lfs.h</a>, or an error returned by the user's block device operations.</p>
<p>In the configuration struct, the <code>prog</code> and <code>erase</code> function provided by the user may return a <code>LFS_ERR_CORRUPT</code> error if the implementation already can detect corrupt blocks. However, the wear leveling does not depend on the return code of these functions, instead all data is read back and checked for integrity.</p>
<p>If your storage caches writes, make sure that the provided <code>sync</code> function flushes all the data to memory and ensures that the next read fetches the data from memory, otherwise data integrity can not be guaranteed. If the <code>write</code> function does not perform caching, and therefore each <code>read</code> or <code>write</code> call hits the memory, the <code>sync</code> function can simply return 0.</p>
<h2>Design</h2>
<p>At a high level, littlefs is a block based filesystem that uses small logs to store metadata and larger copy-on-write (COW) structures to store file data.</p>
<p>In littlefs, these ingredients form a sort of two-layered cake, with the small logs (called metadata pairs) providing fast updates to metadata anywhere on storage, while the COW structures store file data compactly and without any wear amplification cost.</p>
<p>Both of these data structures are built out of blocks, which are fed by a common block allocator. By limiting the number of erases allowed on a block per allocation, the allocator provides dynamic wear leveling over the entire filesystem.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;                    root</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;                   .--------.--------.</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                   | A&#39;| B&#39;|         |</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;                   |   |   |-&gt;       |</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                   |   |   |         |</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                   &#39;--------&#39;--------&#39;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                .----&#39;   &#39;--------------.</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;       A       v                 B       v</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      .--------.--------.       .--------.--------.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      | C&#39;| D&#39;|         |       | E&#39;|new|         |</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      |   |   |-&gt;       |       |   | E&#39;|-&gt;       |</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;      |   |   |         |       |   |   |         |</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;      &#39;--------&#39;--------&#39;       &#39;--------&#39;--------&#39;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      .-&#39;   &#39;--.                  |   &#39;------------------.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;     v          v              .-&#39;                        v</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;.--------.  .--------.        v                       .--------.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;|   C    |  |   D    |   .--------.       write       | new E  |</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;|        |  |        |   |   E    |        ==&gt;        |        |</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;|        |  |        |   |        |                   |        |</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;&#39;--------&#39;  &#39;--------&#39;   |        |                   &#39;--------&#39;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                         &#39;--------&#39;                   .-&#39;    |</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                         .-&#39;    &#39;-.    .-------------|------&#39;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                        v          v  v              v</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                   .--------.  .--------.       .--------.</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;                   |   F    |  |   G    |       | new F  |</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                   |        |  |        |       |        |</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                   |        |  |        |       |        |</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;                   &#39;--------&#39;  &#39;--------&#39;       &#39;--------&#39;</div></div><!-- fragment --><p>More details on how littlefs works can be found in <a class="el" href="_d_e_s_i_g_n_8md.html">DESIGN.md</a> and <a class="el" href="_s_p_e_c_8md.html">SPEC.md</a>.</p>
<ul>
<li><a class="el" href="_d_e_s_i_g_n_8md.html">DESIGN.md</a> - A fully detailed dive into how littlefs works. I would suggest reading it as the tradeoffs at work are quite interesting.</li>
<li><a class="el" href="_s_p_e_c_8md.html">SPEC.md</a> - The on-disk specification of littlefs with all the nitty-gritty details. May be useful for tooling development.</li>
</ul>
<h2>Testing</h2>
<p>The littlefs comes with a test suite designed to run on a PC using the <a href="emubd/lfs_emubd.h">emulated block device</a> found in the emubd directory. The tests assume a Linux environment and can be started with make:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;make test</div></div><!-- fragment --><h2>License</h2>
<p>The littlefs is provided under the <a href="https://spdx.org/licenses/BSD-3-Clause.html">BSD-3-Clause</a> license. See <a class="el" href="_l_i_c_e_n_s_e_8md.html">LICENSE.md</a> for more information. Contributions to this project are accepted under the same license.</p>
<p>Individual files contain the following tag instead of the full license text. </p><pre class="fragment">SPDX-License-Identifier:    BSD-3-Clause
</pre><p>This enables machine processing of license information based on the SPDX License Identifiers that are here available: <a href="http://spdx.org/licenses/">http://spdx.org/licenses/</a></p>
<h2>Related projects</h2>
<ul>
<li><a href="https://github.com/geky/littlefs-fuse">littlefs-fuse</a> - A <a href="https://github.com/libfuse/libfuse">FUSE</a> wrapper for littlefs. The project allows you to mount littlefs directly on a Linux machine. Can be useful for debugging littlefs if you have an SD card handy.</li>
<li><a href="https://github.com/geky/littlefs-js">littlefs-js</a> - A javascript wrapper for littlefs. I'm not sure why you would want this, but it is handy for demos. You can see it in action <a href="http://littlefs.geky.net/demo.html">here</a>.</li>
<li><a href="https://pypi.org/project/littlefs-python/">littlefs-python</a> - A Python wrapper for littlefs. The project allows you to create images of the filesystem on your PC. Check if littlefs will fit your needs, create images for a later download to the target memory or inspect the content of a binary image of the target memory.</li>
<li><a href="https://github.com/whitecatboard/Lua-RTOS-ESP32/tree/master/components/mklfs/src">mklfs</a> - A command line tool built by the <a href="https://github.com/whitecatboard/Lua-RTOS-ESP32">Lua RTOS</a> guys for making littlefs images from a host PC. Supports Windows, Mac OS, and Linux.</li>
<li><a href="https://github.com/armmbed/mbed-os">Mbed OS</a> - The easiest way to get started with littlefs is to jump into Mbed which already has block device drivers for most forms of embedded storage. littlefs is available in Mbed OS as the <a href="https://os.mbed.com/docs/mbed-os/v5.12/apis/littlefilesystem.html">LittleFileSystem</a> class.</li>
<li><a href="https://github.com/pellepl/spiffs">SPIFFS</a> - Another excellent embedded filesystem for NOR flash. As a more traditional logging filesystem with full static wear-leveling, SPIFFS will likely outperform littlefs on small memories such as the internal flash on microcontrollers.</li>
<li><a href="https://github.com/dlbeer/dhara">Dhara</a> - An interesting NAND flash translation layer designed for small MCUs. It offers static wear-leveling and power-resilience with only a fixed <em>O(|address|)</em> pointer structure stored on each block and in RAM. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
